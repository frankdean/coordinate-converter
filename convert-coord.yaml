# Script to build a [Lima}(https://lima-vm.io) based development environment.

minimumLimaVersion: 1.1.0

cpus: 2
memory: 2GiB
disk: 7GiB

base:
- template://_images/debian-12

# mountType: "9p"
# mounts:
# - location: "~"
#   9p:
#     securityModel: "mapped-xattr"
vmType: "vz"  # only for macOS; Linux uses 'qemu'
mountType: "virtiofs"
mounts:
  - location: "."
    mountPoint: "{{.Home}}/convert-coord"
    writable: false
  - location: "./node_modules"
    mountPoint: "{{.Home}}/convert-coord/node_modules"
    writable: true
user:
  name: "lima"
  home: "/home/{{.User}}"

portForwards:
  - guestPort: 5173
    hostPort: 8080
  - guestPort: 4173
    hostPort: 8081
  - guestPort: 80
    hostPort: 8090

provision:
  - mode: system
    script: |
      #!/bin/bash
      COORD_SOURCE={{.Home}}/convert-coord USERNAME={{.User}} GROUPNAME={{.User}} USERHOME={{.Home}} bash -x {{.Home}}/convert-coord/provisioning/bootstrap.sh
      COORD_SOURCE={{.Home}}/convert-coord USERNAME={{.User}} GROUPNAME={{.User}} USERHOME={{.Home}} bash -x {{.Home}}/convert-coord/provisioning/bootconfig.sh
